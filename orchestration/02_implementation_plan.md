# Orchestration: –ü–ª–∞–Ω —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ (6 —ç—Ç–∞–ø–æ–≤)

## –≠—Ç–∞–ø 1 ‚Äî –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ (–î–µ–Ω—å 1‚Äì2)

### –ó–∞–¥–∞—á–∏
- [ ] –í—ã–±—Ä–∞—Ç—å —Ö–æ—Å—Ç–∏–Ω–≥ (Railway –∏–ª–∏ VPS)
- [ ] –°–æ–∑–¥–∞—Ç—å Docker Compose (bot + redis)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –¥–æ–º–µ–Ω + HTTPS (Let's Encrypt)
- [ ] –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Telegram webhook
- [ ] –°–æ–∑–¥–∞—Ç—å —Å—Ç—Ä—É–∫—Ç—É—Ä—É –ø—Ä–æ–µ–∫—Ç–∞ (folders + package.json + tsconfig)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Google Sheets –¥–æ–∫—É–º–µ–Ω—Ç (—Å–æ–∑–¥–∞—Ç—å –ª–∏—Å—Ç—ã, –∑–∞–≥–æ–ª–æ–≤–∫–∏)
- [ ] –°–æ–∑–¥–∞—Ç—å Google Service Account + –≤—ã–¥–∞—Ç—å –¥–æ—Å—Ç—É–ø –∫ Sheets
- [ ] –°–æ–∑–¥–∞—Ç—å Google Calendar –¥–ª—è —Å–ª–æ—Ç–æ–≤
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Zoom Server-to-Server OAuth App
- [ ] –°–æ–∑–¥–∞—Ç—å Resend –∞–∫–∫–∞—É–Ω—Ç + –≤–µ—Ä–∏—Ñ–∏—Ü–∏—Ä–æ–≤–∞—Ç—å –¥–æ–º–µ–Ω email
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

### –†–µ–∑—É–ª—å—Ç–∞—Ç —ç—Ç–∞–ø–∞
- –ü—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –≤ Docker
- Telegram –±–æ—Ç –æ—Ç–≤–µ—á–∞–µ—Ç –Ω–∞ /start (–±–∞–∑–æ–≤—ã–π –æ—Ç–≤–µ—Ç)
- Google Sheets –¥–æ—Å—Ç—É–ø–µ–Ω —á–µ—Ä–µ–∑ Service Account

---

## –≠—Ç–∞–ø 2 ‚Äî Core Bot FSM (–î–µ–Ω—å 2‚Äì4)

### –ó–∞–¥–∞—á–∏
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Telegraf —Å Redis session middleware
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å WelcomeScene (—Ç–µ–∫—Å—Ç + video_note + GDPR)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å RegistrationScene (Phone ‚Üí Email ‚Üí Name)
  - [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è —Ç–µ–ª–µ—Ñ–æ–Ω–∞ (libphonenumber –∏–ª–∏ regex)
  - [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è email
  - [ ] –ö–Ω–æ–ø–∫–∞ "–ü–æ–¥–µ–ª–∏—Ç—å—Å—è –Ω–æ–º–µ—Ä–æ–º" (contact button)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å SheetsService (CRUD –æ–ø–µ—Ä–∞—Ü–∏–∏)
  - [ ] createLead / upsertLead
  - [ ] updateField
  - [ ] findByTgId / findByEmail
  - [ ] appendLog
- [ ] –ò–Ω—Ç–µ–≥—Ä–∏—Ä–æ–≤–∞—Ç—å SheetsService –≤ —Å—Ü–µ–Ω—ã
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å /start, /help, /status, /menu –∫–æ–º–∞–Ω–¥—ã
- [ ] –¢–µ—Å—Ç: –ø–æ–ª–Ω—ã–π –ø—É—Ç—å Welcome ‚Üí Phone ‚Üí Email ‚Üí Name ‚Üí GSheets

### –†–µ–∑—É–ª—å—Ç–∞—Ç —ç—Ç–∞–ø–∞
- –ö–ª–∏–µ–Ω—Ç –º–æ–∂–µ—Ç –ø—Ä–æ–π—Ç–∏ –≤–µ—Å—å –ø—É—Ç—å —Ä–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏–∏
- –î–∞–Ω–Ω—ã–µ –∑–∞–ø–∏—Å—ã–≤–∞—é—Ç—Å—è –≤ Google Sheets

---

## –≠—Ç–∞–ø 3 ‚Äî DatePicker + Zoom (–î–µ–Ω—å 4‚Äì6)

### –ó–∞–¥–∞—á–∏
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å CalendarService (Google Calendar API)
  - [ ] getAvailableSlots(daysAhead: 14): list of {date, time, eventId}
  - [ ] markSlotBusy(eventId, clientInfo)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å DatePickerScene
  - [ ] InlineKeyboard —Å –¥–∞—Ç–∞–º–∏ (–∫–Ω–æ–ø–∫–∏ –ø–æ –¥–Ω—è–º)
  - [ ] InlineKeyboard —Å –≤—Ä–µ–º–µ–Ω–Ω—ã–º–∏ —Å–ª–æ—Ç–∞–º–∏
  - [ ] –≠–∫—Ä–∞–Ω –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å ZoomService
  - [ ] getAccessToken() (Server-to-Server OAuth, –∫—ç—à –≤ Redis)
  - [ ] createMeeting({topic, start_time, duration, timezone})
- [ ] –ü–æ–¥–∫–ª—é—á–∏—Ç—å Zoom –∫ DatePickerScene (–ø–æ—Å–ª–µ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏—è)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å BullMQ reminderQueue
  - [ ] add('remind24h', ...) –ø—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ Zoom
  - [ ] ReminderWorker: –æ—Ç–ø—Ä–∞–≤–∏—Ç—å Telegram-—Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ –±–æ—Ç
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å confirmation callbacks (‚úÖ –î–∞ / üìÖ –ü–µ—Ä–µ–Ω–µ—Å—Ç–∏)
- [ ] –¢–µ—Å—Ç: –ø–æ–ª–Ω—ã–π –ø—É—Ç—å –¥–æ –ø–æ–ª—É—á–µ–Ω–∏—è Zoom-—Å—Å—ã–ª–∫–∏

### –†–µ–∑—É–ª—å—Ç–∞—Ç —ç—Ç–∞–ø–∞
- –ö–ª–∏–µ–Ω—Ç –∑–∞–ø–∏—Å—ã–≤–∞–µ—Ç—Å—è –Ω–∞ —É—Ä–æ–∫
- –ü–æ–ª—É—á–∞–µ—Ç Zoom-—Å—Å—ã–ª–∫—É –≤ –±–æ—Ç–µ
- –ù–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ –∑–∞ 24—á —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## –≠—Ç–∞–ø 4 ‚Äî Admin —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è + Reminder 5h (–î–µ–Ω—å 6‚Äì7)

### –ó–∞–¥–∞—á–∏
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram-–≥—Ä—É–ø–ø—É –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
  - [ ] –ü—Ä–∏ –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–∏ –∫–ª–∏–µ–Ω—Ç–∞
  - [ ] –ü—Ä–∏ –æ—Ç–∫–∞–∑–µ –∫–ª–∏–µ–Ω—Ç–∞
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å remind5h job
  - [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞: –µ—Å–ª–∏ confirmed=FALSE ‚Üí –æ—Ç–ø—Ä–∞–≤–∏—Ç—å –ø–æ–≤—Ç–æ—Ä–Ω–æ–µ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å ScheduledScene (–ø–æ—Å–ª–µ –∑–∞–ø–∏—Å–∏)
  - [ ] /status –∫–æ–º–∞–Ω–¥–∞
  - [ ] –ö–Ω–æ–ø–∫–∏: AI, –ú–µ–Ω–µ–¥–∂–µ—Ä, –°—Ç–∞—Ç—É—Å
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å GSheets —Å—Ç–∞—Ç—É—Å–Ω—ã–µ –∞–ø–¥–µ–π—Ç—ã –ø—Ä–∏ –∫–∞–∂–¥–æ–º —Å–æ–±—ã—Ç–∏–∏
- [ ] –¢–µ—Å—Ç: –ø–æ–ª–Ω—ã–π 24—á —Ü–∏–∫–ª (–∑–∞–ø–∏—Å—å ‚Üí –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ ‚Üí –º–µ–Ω–µ–¥–∂–µ—Ä)

### –†–µ–∑—É–ª—å—Ç–∞—Ç —ç—Ç–∞–ø–∞
- –í—Å—è —Ü–µ–ø–æ—á–∫–∞ –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–π —Ä–∞–±–æ—Ç–∞–µ—Ç
- –ú–µ–Ω–µ–¥–∂–µ—Ä –≤–∏–¥–∏—Ç —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –≤ Telegram-–≥—Ä—É–ø–ø–µ

---

## –≠—Ç–∞–ø 5 ‚Äî Tilda webhook + Email chain (–î–µ–Ω—å 7‚Äì9)

### –ó–∞–¥–∞—á–∏
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å Tilda webhook endpoint (POST /webhook/tilda)
  - [ ] –í–∞–ª–∏–¥–∞—Ü–∏—è X-Tilda-Secret
  - [ ] –ù–æ—Ä–º–∞–ª–∏–∑–∞—Ü–∏—è –¥–∞–Ω–Ω—ã—Ö –∏–∑ Tilda
  - [ ] upsertLead —Å source='tilda'
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å EmailService (Resend API)
  - [ ] sendEmail1(email, name) ‚Äî 30–º–∏–Ω –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ
  - [ ] sendEmail2(email, name) ‚Äî 24—á –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏–µ
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å emailChainQueue + EmailChainWorker
  - [ ] email1 job (delay 30min) ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ bot_activated ‚Üí Email #1
  - [ ] email2 job (delay 24h) ‚Üí –ø—Ä–æ–≤–µ—Ä–∫–∞ bot_activated ‚Üí Email #2
  - [ ] callAlert job (delay 24h) ‚Üí —Å—Ç–∞—Ç—É—Å CALL_NEEDED ‚Üí Telegram –º–µ–Ω–µ–¥–∂–µ—Ä—É
- [ ] –õ–æ–≥–∏–∫–∞ –æ—Ç–º–µ–Ω—ã —Ü–µ–ø–æ—á–∫–∏ –ø—Ä–∏ bot_activated=TRUE
  - [ ] –ü—Ä–∏ /start: –Ω–∞–π—Ç–∏ jobId –≤ Redis ‚Üí BullMQ.remove(jobId)
- [ ] –ù–∞—Å—Ç—Ä–æ–∏—Ç—å Tilda webhook –≤ –ø–∞–Ω–µ–ª–∏ Tilda (—É–∫–∞–∑–∞—Ç—å URL)
- [ ] –¢–µ—Å—Ç: –∑–∞–ø–æ–ª–Ω–∏—Ç—å —Ñ–æ—Ä–º—É ‚Üí —á–µ—Ä–µ–∑ 30–º–∏–Ω –ø–æ–ª—É—á–∏—Ç—å email ‚Üí –≤–æ–π—Ç–∏ –≤ –±–æ—Ç ‚Üí —Ü–µ–ø–æ—á–∫–∞ –æ—Ç–º–µ–Ω—è–µ—Ç—Å—è

### –†–µ–∑—É–ª—å—Ç–∞—Ç —ç—Ç–∞–ø–∞
- –ü–æ–ª–Ω–∞—è –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –æ—Ç Tilda –¥–æ –±–æ—Ç–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç
- Email-—Ü–µ–ø–æ—á–∫–∞ –¥–ª—è –Ω–µ-–∞–∫—Ç–∏–≤–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –∫–ª–∏–µ–Ω—Ç–æ–≤ —Ä–∞–±–æ—Ç–∞–µ—Ç

---

## –≠—Ç–∞–ø 6 ‚Äî AI + Voice (–î–µ–Ω—å 9‚Äì12)

### –ó–∞–¥–∞—á–∏
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å OpenAIService
  - [ ] chatWithAssistant(tgId, message) ‚Üí response
    - [ ] Pre-filter
    - [ ] Chat completion (GPT-4o mini + history from Redis)
    - [ ] Post-filter
  - [ ] transcribeVoice(audioBuffer) ‚Üí text (Whisper)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å AIGuard (pre/post filters)
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å VoiceHandler (global middleware)
  - [ ] –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ñ–∞–π–ª —Å Telegram
  - [ ] Whisper transcription
  - [ ] –ü–µ—Ä–µ–¥–∞—Ç—å –≤ —Å—Ü–µ–Ω—É –∏–ª–∏ AIHandler
- [ ] –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å AIHandler
  - [ ] –ê–∫—Ç–∏–≤–∞—Ü–∏—è –ø–æ /ai –∏–ª–∏ –ø–∞—Ç—Ç–µ—Ä–Ω–∞–º –≤–æ–ø—Ä–æ—Å–∞
  - [ ] Rate limiting (Redis)
  - [ ] –ò—Å—Ç–æ—Ä–∏—è —Ä–∞–∑–≥–æ–≤–æ—Ä–∞ (Redis)
  - [ ] –ö–Ω–æ–ø–∫–∞ "‚Ü© –í–µ—Ä–Ω—É—Ç—å—Å—è"
- [ ] –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –±–µ–∑–æ–ø–∞—Å–Ω–æ—Å—Ç–∏ AI
  - [ ] Prompt injection –ø–æ–ø—ã—Ç–∫–∏
  - [ ] –í–æ–ø—Ä–æ—Å—ã –æ —Ü–µ–Ω–µ
  - [ ] –ü–æ–ø—ã—Ç–∫–∏ —Ä–∞—Å–∫—Ä—ã—Ç—å –ø—Ä–æ–º–ø—Ç
- [ ] –¢–µ—Å—Ç: –ø–æ–ª–Ω—ã–π AI-—Ä–∞–∑–≥–æ–≤–æ—Ä + –≤–æ–∑–≤—Ä–∞—Ç –≤ —Å—Ü–µ–Ω—É

### –†–µ–∑—É–ª—å—Ç–∞—Ç —ç—Ç–∞–ø–∞
- AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç —Ä–∞–±–æ—Ç–∞–µ—Ç –∏–∑ –ª—é–±–æ–≥–æ —Å–æ—Å—Ç–æ—è–Ω–∏—è
- –ì–æ–ª–æ—Å–æ–≤—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è —Ç—Ä–∞–Ω—Å–∫—Ä–∏–±–∏—Ä—É—é—Ç—Å—è

---

## –≠—Ç–∞–ø 7 ‚Äî QA –∏ –∑–∞–ø—É—Å–∫ (–î–µ–Ω—å 12‚Äì14)

### –ó–∞–¥–∞—á–∏
- [ ] End-to-end —Ç–µ—Å—Ç –°—Ü–µ–Ω–∞—Ä–∏–π 1: Tilda ‚Üí email ‚Üí –±–æ—Ç ‚Üí –∑–∞–ø–∏—Å—å ‚Üí –ø–æ–¥—Ç–≤–µ—Ä–∂–¥–µ–Ω–∏–µ
- [ ] End-to-end —Ç–µ—Å—Ç –°—Ü–µ–Ω–∞—Ä–∏–π 2: –ü—Ä—è–º–æ–π /start ‚Üí –∑–∞–ø–∏—Å—å ‚Üí –Ω–∞–ø–æ–º–∏–Ω–∞–Ω–∏—è
- [ ] End-to-end —Ç–µ—Å—Ç –°—Ü–µ–Ω–∞—Ä–∏–π 3: AI-–∞—Å—Å–∏—Å—Ç–µ–Ω—Ç –∏–∑ —Ä–∞–∑–Ω—ã—Ö —Å—Ü–µ–Ω
- [ ] End-to-end —Ç–µ—Å—Ç –°—Ü–µ–Ω–∞—Ä–∏–π 4: –≥–æ–ª–æ—Å–æ–≤–æ–µ ‚Üí —Ç—Ä–∞–Ω—Å–∫—Ä–∏–ø—Ü–∏—è ‚Üí AI
- [ ] –¢–µ—Å—Ç edge cases:
  - [ ] –î—É–±–ª–∏–∫–∞—Ç—ã (–æ–¥–∏–Ω email —Å Tilda + –ø—Ä—è–º–æ–π /start)
  - [ ] –ù–µ—Ç —Å–ª–æ—Ç–æ–≤ –≤ Calendar
  - [ ] Zoom API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
  - [ ] Google Sheets API –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ GDPR —Å–æ–≥–ª–∞—Å–∏—è
- [ ] –ü—Ä–æ–≤–µ—Ä–∫–∞ —É—Å–ª–æ–≤–Ω–æ–≥–æ —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏—è Google Sheets
- [ ] Soft launch: —Ç–µ—Å—Ç —Å —Ä–µ–∞–ª—å–Ω—ã–º–∏ –∫–ª–∏–µ–Ω—Ç–∞–º–∏ (5‚Äì10 —á–µ–ª–æ–≤–µ–∫)
- [ ] Production deploy

### –†–µ–∑—É–ª—å—Ç–∞—Ç —ç—Ç–∞–ø–∞
- –°–∏—Å—Ç–µ–º–∞ –ø–æ–ª–Ω–æ—Å—Ç—å—é –≥–æ—Ç–æ–≤–∞ –∫ production

---

## –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è (—á–µ–∫–ª–∏—Å—Ç –¥–ª—è –∫–ª–∏–µ–Ω—Ç–∞)

- [ ] –¢–æ–∫–µ–Ω Telegram –±–æ—Ç–∞ (–∏–∑ @BotFather)
- [ ] ID Telegram-–≥—Ä—É–ø–ø—ã –º–µ–Ω–µ–¥–∂–µ—Ä–æ–≤
- [ ] @username –º–µ–Ω–µ–¥–∂–µ—Ä–∞ –¥–ª—è AI-—Ä–µ–¥–∏—Ä–µ–∫—Ç–∞
- [ ] Zoom Account ID, Client ID, Client Secret
- [ ] Google Sheets ID (—Å–æ–∑–¥–∞—Ç—å —Ç–∞–±–ª–∏—Ü—É)
- [ ] Google Calendar ID (—Å–æ–∑–¥–∞—Ç—å –∫–∞–ª–µ–Ω–¥–∞—Ä—å)
- [ ] Google Service Account JSON
- [ ] Resend API Key + –≤–µ—Ä–∏—Ñ–∏–∫–∞—Ü–∏—è –¥–æ–º–µ–Ω–∞ allinacademy.ee
- [ ] –î–æ–º–µ–Ω –¥–ª—è –¥–µ–ø–ª–æ—è
- [ ] –í–∏–¥–µ–æ-–∫—Ä—É–∂–æ–∫ –æ—Ç –≤–ª–∞–¥–µ–ª—å—Ü–∞ —à–∫–æ–ª—ã (–∑–∞–≥—Ä—É–∑–∏—Ç—å –≤ –±–æ—Ç, –ø–æ–ª—É—á–∏—Ç—å file_id)
